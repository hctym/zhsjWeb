<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis_mapper.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhsj.dao.StoreAccountDao">

    <!-- 添加-->
    <insert id="add" keyProperty="id">
        insert into tb_store_account (
	         account,
	         password,
	         open_id,
	         name,
	         head_img,
	         gender,
	         mobile,
	         email,
	         status,
	         valid,
	         utime,
	         ctime
         ) values (
             #{account},
             #{password},
             #{openId},
             #{name},
             #{headImg},
             #{gender},
             #{mobile},
             #{email},
             #{status},
             #{valid},
             #{utime},
             #{ctime}
         )
    </insert>
    
    <!-- 商户门店用户和角色 -->
    <resultMap type="com.zhsj.model.StoreAccount" id="storeAccountRole">
	       <id column="id" property="id"/>
	       <result column="account" property="account"/>
	       <result column="password" property="password"/>
	       <result column="open_id" property="openId"/>
	       <result column="name" property="name"/>
	       <result column="head_img" property="headImg"/>
	       <result column="gender" property="gender"/>
	       <result column="mobile" property="mobile"/>
	       <result column="email" property="email"/>
	       <result column="status" property="status"/>
	       <result column="valid" property="valid"/>
	       <association property="role" javaType="com.zhsj.model.Role">
	           <id column="roleId" property="id"/>
	       </association>
    </resultMap>
    <!-- 通过账户名查找账户信息 -->
    <select id="getByName" resultMap="storeAccountRole">
<!--          select * from tb_store_account where account = #{account} -->
             select  
                  sa.id,
		          sa.account,
			      sa.password,
			      sa.open_id 'openId',
			      sa.name,
			      sa.head_img 'headImg',
			      sa.gender,
			      sa.mobile,
			      sa.email,
			      sa.status,
			      sa.valid,
			      sa.utime,
			      sa.ctime,
			      saRole.role_id roleId
             from tb_store_account sa
             left join tb_store_account_bind_role saRole
             on sa.id = saRole.account_id
             where sa.account = #{account}
    </select>
    
    <!-- 用户名和密码查找账户 -->
    <select id="getByNameAndMd5PassWord" resultMap="storeAccountRole">
             select  
	              sa.id,
		          sa.account,
			      sa.password,
			      sa.open_id 'openId',
			      sa.name,
			      sa.head_img 'headImg',
			      sa.gender,
			      sa.mobile,
			      sa.email,
			      sa.status,
			      sa.valid,
			      sa.utime,
			      sa.ctime,
			      saRole.role_id roleId
	         from tb_store_account sa
             left join tb_store_account_bind_role saRole
             on sa.id = saRole.account_id where account = #{username} and password = #{md5password}
    </select>
    <!-- 通过商户门店编号查找关联的账户 -->
    <select id="getList" resultType="com.zhsj.model.StoreAccount">
       select
          sa.id,
          sa.account,
	      sa.password,
	      sa.open_id 'openId',
	      sa.name,
	      sa.head_img 'headImg',
	      sa.gender,
	      sa.mobile,
	      sa.email,
	      sa.status,
	      sa.valid,
	      sa.utime,
	      sa.ctime 
       from tb_store_account sa
       left join tb_store_bind_account sba 
       on sa.id = sba.store_account_id
       where sba.store_no = #{storeNo} limit #{row},#{pageSize}
    </select>
    
    <!-- 通过用户id 查询角色 -->
    <select id="getRole" resultType="com.zhsj.model.Role">
       select 
         role.*    
       from tb_role role 
       left join tb_store_account_bind_role sabr
       on role.id = sabr.role_id
       where sabr.account_id = #{id}
    </select>
    
    
</mapper>